# 2.2 コードを実行してテキスト生成を行う

このセクションでは、Bedrockを使ってテキスト生成を行います。

以下の内容で「simple_chat.py」という名前で新規ファイルを作成します。

```python:simple_chat.py
import os
from langchain_aws import ChatBedrock
from langchain_core.messages import HumanMessage
from langchain_core.prompts import ChatPromptTemplate, MessagesPlaceholder


model_id = 'anthropic.claude-3-haiku-20240307-v1:0'
region_name = 'us-east-1'


chat = ChatBedrock(
    model_id=model_id,
    model_kwargs={"temperature": 0.1},
    region_name=region_name
)

prompt = ChatPromptTemplate.from_messages(
    [
        ("system", "あなたはAIアシスタントです。"),
        MessagesPlaceholder(variable_name="messages"),
    ]
)


def chat_simple(question):
    chain = prompt | chat
    result = chain.invoke(
        {
            "messages": [HumanMessage(content=question)]
        }
    )
    return result.content


if __name__ == "__main__":
    question = "日本の首都はどこですか？"
    print(chat_simple(question))
```

## コードの解説

このコードでは、LangChain から Bedrock のモデル呼び出しを行っています。

```python:モデルの呼び出し
chat = ChatBedrock(
    model_id=model_id,
    model_kwargs={"temperature": 0.1},
    region_name=region_name
)
```
上記のように [ChatBedrock クラス](https://python.langchain.com/v0.2/docs/integrations/chat/bedrock/)へ利用するモデルID(model_id)、モデルへのパラメータ(model_kwargs)、利用するモデルのAWSリージョン(region_name)を指定します。

- [モデルIDについて](https://docs.aws.amazon.com/ja_jp/bedrock/latest/userguide/model-ids.html)
- [モデルパラメータ](https://docs.aws.amazon.com/ja_jp/bedrock/latest/userguide/model-parameters.html)

今回のコードでは、 Anthropic 社の Claude 3 Haiku を利用します。


```python
prompt = ChatPromptTemplate.from_messages(
    [
        ("system", "あなたはAIアシスタントです。"),
        MessagesPlaceholder(variable_name="messages"),
    ]
)
```
上記のコードでは、 [ChatPromptTemplate クラス](https://api.python.langchain.com/en/latest/prompts/langchain_core.prompts.chat.ChatPromptTemplate.html) を使ってモデルへ入力するプロンプトの定義を行なっています。

この時点では、入力テキストは与えられておらず、[MessagesPlaceholder クラス](https://api.python.langchain.com/en/latest/prompts/langchain_core.prompts.chat.MessagesPlaceholder.html) で入力テキストを受け取る際のプレースホルダーを定義しています。


